{"type":"file-history-snapshot","messageId":"c9bd10fe-f788-430c-91bd-359dca01881f","snapshot":{"messageId":"c9bd10fe-f788-430c-91bd-359dca01881f","trackedFileBackups":{},"timestamp":"2025-11-28T02:56:35.760Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","type":"user","message":{"role":"user","content":"Caveat: The messages below were generated by the user while running local commands. DO NOT respond to these messages or otherwise consider them in your response unless the user explicitly asks you to."},"isMeta":true,"uuid":"1d9b4069-4a0d-403d-813f-09bc50f494b8","timestamp":"2025-11-28T02:56:35.760Z"}
{"parentUuid":"1d9b4069-4a0d-403d-813f-09bc50f494b8","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","type":"user","message":{"role":"user","content":"<command-name>/clear</command-name>\n            <command-message>clear</command-message>\n            <command-args></command-args>"},"uuid":"c9bd10fe-f788-430c-91bd-359dca01881f","timestamp":"2025-11-28T02:56:35.752Z"}
{"parentUuid":"c9bd10fe-f788-430c-91bd-359dca01881f","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","type":"user","message":{"role":"user","content":"<local-command-stdout></local-command-stdout>"},"uuid":"823e1db7-d56c-4dbd-80a7-f1dada467cdd","timestamp":"2025-11-28T02:56:35.760Z"}
{"type":"file-history-snapshot","messageId":"abd0f8e4-f701-43d6-83bf-cf9178a76758","snapshot":{"messageId":"abd0f8e4-f701-43d6-83bf-cf9178a76758","trackedFileBackups":{},"timestamp":"2025-11-28T03:00:12.487Z"},"isSnapshotUpdate":false}
{"parentUuid":"823e1db7-d56c-4dbd-80a7-f1dada467cdd","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","type":"user","message":{"role":"user","content":"https://platform.claude.com/docs/en/agent-sdk/python can you explain how the claude code SDK works?"},"uuid":"abd0f8e4-f701-43d6-83bf-cf9178a76758","timestamp":"2025-11-28T03:00:12.486Z","thinkingMetadata":{"level":"none","disabled":true,"triggers":[]}}
{"parentUuid":"abd0f8e4-f701-43d6-83bf-cf9178a76758","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","message":{"model":"claude-haiku-4-5-20251001","id":"msg_018sPA2tSNZ9pi78DD8yzAjK","type":"message","role":"assistant","content":[{"type":"text","text":"I'll look up the official Claude Code and Claude Agent SDK documentation for you."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":34061,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":34061,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CVZYJ4N2pz1sV3c8Qnhfp","type":"assistant","uuid":"0a9b44f3-4f85-456b-83f8-9d741e0270c3","timestamp":"2025-11-28T03:00:14.364Z"}
{"parentUuid":"0a9b44f3-4f85-456b-83f8-9d741e0270c3","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","message":{"model":"claude-haiku-4-5-20251001","id":"msg_018sPA2tSNZ9pi78DD8yzAjK","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018P8YzXbmZy33cYmQXsxaNn","name":"Task","input":{"subagent_type":"claude-code-guide","description":"Explain Claude Agent SDK","prompt":"The user is asking for an explanation of how the Claude Agent SDK works. Please provide a comprehensive explanation of:\n\n1. What the Claude Agent SDK is and its purpose\n2. How it works and its core concepts\n3. Key components and their roles\n4. How agents are created and executed\n5. Any important features or capabilities users should know about\n\nPlease reference the official documentation from the provided URL and give clear, practical explanations suitable for someone new to the SDK."}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":34061,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":34061,"ephemeral_1h_input_tokens":0},"output_tokens":210,"service_tier":"standard"},"context_management":{"applied_edits":[]}},"requestId":"req_011CVZYJ4N2pz1sV3c8Qnhfp","type":"assistant","uuid":"f68aaa6d-4bf6-49f1-a83b-6f3306576925","timestamp":"2025-11-28T03:00:15.646Z"}
{"parentUuid":"f68aaa6d-4bf6-49f1-a83b-6f3306576925","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018P8YzXbmZy33cYmQXsxaNn","type":"tool_result","content":[{"type":"text","text":"Based on my web search results, I can provide you with a comprehensive explanation of the Claude Agent SDK. Let me compile the information from the available documentation sources:\n\n## Comprehensive Guide to the Claude Agent SDK\n\n### 1. What is the Claude Agent SDK and Its Purpose\n\nThe **Claude Agent SDK** is a production-ready framework for building intelligent agents powered by Claude. Unlike traditional stateless LLM APIs, the SDK is purpose-built for creating agents that maintain conversational state and execute commands in a persistent environment. It evolved from the agent harness that powers Claude Code and has expanded beyond its original coding-focused capabilities to support building agents across various domains and use cases.\n\n**Key Purpose**: Enable developers to build autonomous agents that can plan, execute actions, and interact with external tools while maintaining context across multiple interactions.\n\n### 2. How It Works and Core Concepts\n\nThe Claude Agent SDK operates on several core principles:\n\n**State Management**: The SDK maintains conversational state throughout agent execution, allowing agents to remember context and build upon previous interactions and decisions.\n\n**Persistent Execution Environment**: Unlike stateless APIs, agents run in a persistent environment where they can:\n- Execute code and commands\n- Access file systems\n- Maintain session information\n- Build on previous execution results\n\n**Automatic Context Optimization**: The SDK includes built-in context management and automatic compaction to ensure your agent doesn't exceed context limits—this is crucial for long-running agents handling complex tasks.\n\n**Tool Integration**: The SDK provides a comprehensive tool ecosystem with permissions management, allowing controlled access to various capabilities.\n\n### 3. Key Components and Their Roles\n\nThe Claude Agent SDK includes several specialized building blocks:\n\n**Core Tools & Capabilities**:\n- File operations (read, write, manage files)\n- Code execution (run and debug code in the persistent environment)\n- Web search (access current information)\n- MCP Integration (Model Context Protocol servers for extended functionality)\n- Advanced permissions system for fine-grained control over agent capabilities\n\n**Specialized Agent Types**:\n- **Subagents**: Launch specialized agents stored as Markdown files, allowing you to decompose complex problems into focused sub-tasks\n- **Agent Skills**: Extend Claude with specialized capabilities for specific domains or use cases\n- **Hooks**: Pre and post-execution hooks for event-driven agent logic\n- **Slash Commands**: Custom commands to trigger specific agent behaviors\n- **Plugins**: Extensibility mechanism for custom integrations\n\n**Production Infrastructure**:\n- Error handling and recovery mechanisms\n- Session management for multi-turn interactions\n- Built-in monitoring and observability\n- Automatic prompt caching for performance optimization\n- Resource management (CPU, memory, storage limits in sandboxed environments)\n\n### 4. How Agents Are Created and Executed\n\nWhile I couldn't access the full Python API reference due to access restrictions, based on the documentation structure, agent creation typically involves:\n\n**Creation Pattern**:\n1. Initialize an agent instance with the SDK\n2. Define the agent's capabilities (tools, skills, permissions)\n3. Configure behavior through hooks and slash commands\n4. Set up external integrations (MCP servers, APIs)\n\n**Execution Pattern**:\n1. Start a conversation or task with the agent\n2. The agent processes your request using Claude's reasoning\n3. The agent identifies what tools or actions are needed\n4. The SDK executes those actions in the persistent environment\n5. Results are fed back to Claude for further planning\n6. The cycle repeats until the agent achieves the goal\n\n**Key Architectural Pattern**: The SDK follows an agentic loop where Claude decides what to do next based on available tools and the current state, executes those decisions, and then re-evaluates based on results.\n\n### 5. Important Features and Capabilities\n\n**Production-Ready Features**:\n- **Sandboxed Execution**: Agents run in isolated container environments with process isolation and resource limits\n- **Context Management**: Automatic handling of context length constraints for long-running tasks\n- **Prompt Caching**: Performance optimizations to reduce latency and API costs\n- **Advanced Permissions**: Fine-grained control over what tools and operations agents can access\n\n**Extensibility**:\n- **Custom Skills**: Create domain-specific capabilities for specialized agent behavior\n- **MCP Servers**: Integrate external services and data sources via the Model Context Protocol\n- **Subagents**: Compose complex systems by having agents delegate to specialized sub-agents\n- **Hooks**: Implement custom logic at pre and post-execution phases\n\n**Developer Experience**:\n- Migration support from older agent patterns\n- Comprehensive Python API reference\n- Clear separation between development and production hosting considerations\n\n### 6. Key Resources for Getting Started\n\nTo dive deeper into the Claude Agent SDK, consult these official documentation pages:\n\nSources:\n- [Agent SDK overview](https://platform.claude.com/docs/en/agent-sdk/overview)\n- [Agent SDK Python reference](https://platform.claude.com/docs/en/agent-sdk/python)\n- [Agent Skills in the SDK](https://platform.claude.com/docs/en/agent-sdk/skills)\n- [Subagents in the SDK](https://platform.claude.com/docs/en/agent-sdk/subagents)\n- [Hosting the Agent SDK](https://platform.claude.com/docs/en/agent-sdk/hosting)\n- [Agent Skills - Claude Code Docs](https://docs.claude.com/en/docs/claude-code/skills)\n\nThe Agent SDK represents a significant advancement in building production-grade autonomous agents with Claude, providing the infrastructure, tools, and extensibility patterns needed for real-world deployment."}]}]},"uuid":"6683e4ef-b7a8-47a4-939f-4a475635743c","timestamp":"2025-11-28T03:00:44.990Z","toolUseResult":{"status":"completed","prompt":"The user is asking for an explanation of how the Claude Agent SDK works. Please provide a comprehensive explanation of:\n\n1. What the Claude Agent SDK is and its purpose\n2. How it works and its core concepts\n3. Key components and their roles\n4. How agents are created and executed\n5. Any important features or capabilities users should know about\n\nPlease reference the official documentation from the provided URL and give clear, practical explanations suitable for someone new to the SDK.","agentId":"54ec8720","content":[{"type":"text","text":"Based on my web search results, I can provide you with a comprehensive explanation of the Claude Agent SDK. Let me compile the information from the available documentation sources:\n\n## Comprehensive Guide to the Claude Agent SDK\n\n### 1. What is the Claude Agent SDK and Its Purpose\n\nThe **Claude Agent SDK** is a production-ready framework for building intelligent agents powered by Claude. Unlike traditional stateless LLM APIs, the SDK is purpose-built for creating agents that maintain conversational state and execute commands in a persistent environment. It evolved from the agent harness that powers Claude Code and has expanded beyond its original coding-focused capabilities to support building agents across various domains and use cases.\n\n**Key Purpose**: Enable developers to build autonomous agents that can plan, execute actions, and interact with external tools while maintaining context across multiple interactions.\n\n### 2. How It Works and Core Concepts\n\nThe Claude Agent SDK operates on several core principles:\n\n**State Management**: The SDK maintains conversational state throughout agent execution, allowing agents to remember context and build upon previous interactions and decisions.\n\n**Persistent Execution Environment**: Unlike stateless APIs, agents run in a persistent environment where they can:\n- Execute code and commands\n- Access file systems\n- Maintain session information\n- Build on previous execution results\n\n**Automatic Context Optimization**: The SDK includes built-in context management and automatic compaction to ensure your agent doesn't exceed context limits—this is crucial for long-running agents handling complex tasks.\n\n**Tool Integration**: The SDK provides a comprehensive tool ecosystem with permissions management, allowing controlled access to various capabilities.\n\n### 3. Key Components and Their Roles\n\nThe Claude Agent SDK includes several specialized building blocks:\n\n**Core Tools & Capabilities**:\n- File operations (read, write, manage files)\n- Code execution (run and debug code in the persistent environment)\n- Web search (access current information)\n- MCP Integration (Model Context Protocol servers for extended functionality)\n- Advanced permissions system for fine-grained control over agent capabilities\n\n**Specialized Agent Types**:\n- **Subagents**: Launch specialized agents stored as Markdown files, allowing you to decompose complex problems into focused sub-tasks\n- **Agent Skills**: Extend Claude with specialized capabilities for specific domains or use cases\n- **Hooks**: Pre and post-execution hooks for event-driven agent logic\n- **Slash Commands**: Custom commands to trigger specific agent behaviors\n- **Plugins**: Extensibility mechanism for custom integrations\n\n**Production Infrastructure**:\n- Error handling and recovery mechanisms\n- Session management for multi-turn interactions\n- Built-in monitoring and observability\n- Automatic prompt caching for performance optimization\n- Resource management (CPU, memory, storage limits in sandboxed environments)\n\n### 4. How Agents Are Created and Executed\n\nWhile I couldn't access the full Python API reference due to access restrictions, based on the documentation structure, agent creation typically involves:\n\n**Creation Pattern**:\n1. Initialize an agent instance with the SDK\n2. Define the agent's capabilities (tools, skills, permissions)\n3. Configure behavior through hooks and slash commands\n4. Set up external integrations (MCP servers, APIs)\n\n**Execution Pattern**:\n1. Start a conversation or task with the agent\n2. The agent processes your request using Claude's reasoning\n3. The agent identifies what tools or actions are needed\n4. The SDK executes those actions in the persistent environment\n5. Results are fed back to Claude for further planning\n6. The cycle repeats until the agent achieves the goal\n\n**Key Architectural Pattern**: The SDK follows an agentic loop where Claude decides what to do next based on available tools and the current state, executes those decisions, and then re-evaluates based on results.\n\n### 5. Important Features and Capabilities\n\n**Production-Ready Features**:\n- **Sandboxed Execution**: Agents run in isolated container environments with process isolation and resource limits\n- **Context Management**: Automatic handling of context length constraints for long-running tasks\n- **Prompt Caching**: Performance optimizations to reduce latency and API costs\n- **Advanced Permissions**: Fine-grained control over what tools and operations agents can access\n\n**Extensibility**:\n- **Custom Skills**: Create domain-specific capabilities for specialized agent behavior\n- **MCP Servers**: Integrate external services and data sources via the Model Context Protocol\n- **Subagents**: Compose complex systems by having agents delegate to specialized sub-agents\n- **Hooks**: Implement custom logic at pre and post-execution phases\n\n**Developer Experience**:\n- Migration support from older agent patterns\n- Comprehensive Python API reference\n- Clear separation between development and production hosting considerations\n\n### 6. Key Resources for Getting Started\n\nTo dive deeper into the Claude Agent SDK, consult these official documentation pages:\n\nSources:\n- [Agent SDK overview](https://platform.claude.com/docs/en/agent-sdk/overview)\n- [Agent SDK Python reference](https://platform.claude.com/docs/en/agent-sdk/python)\n- [Agent Skills in the SDK](https://platform.claude.com/docs/en/agent-sdk/skills)\n- [Subagents in the SDK](https://platform.claude.com/docs/en/agent-sdk/subagents)\n- [Hosting the Agent SDK](https://platform.claude.com/docs/en/agent-sdk/hosting)\n- [Agent Skills - Claude Code Docs](https://docs.claude.com/en/docs/claude-code/skills)\n\nThe Agent SDK represents a significant advancement in building production-grade autonomous agents with Claude, providing the infrastructure, tools, and extensibility patterns needed for real-world deployment."}],"totalDurationMs":29312,"totalTokens":11506,"totalToolUseCount":6,"usage":{"input_tokens":5,"cache_creation_input_tokens":541,"cache_read_input_tokens":9709,"cache_creation":{"ephemeral_5m_input_tokens":541,"ephemeral_1h_input_tokens":0},"output_tokens":1251,"service_tier":"standard"}}}
{"parentUuid":"6683e4ef-b7a8-47a4-939f-4a475635743c","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01KtbyfBLzbW9sMiBNmq8eJM","type":"message","role":"assistant","content":[{"type":"text","text":"The Claude Agent SDK is a production-ready framework for building autonomous agents powered by Claude. Here's how it works:\n\n## Core Architecture\n\nThe SDK maintains a **persistent execution environment** where agents can execute code, access files, and maintain conversation state—unlike stateless APIs. This allows agents to build on previous interactions and accomplish complex, multi-step tasks.\n\n## How It Works\n\n1. **You give the agent a task** - The agent receives your request with context about what tools are available\n2. **Claude reasons about the task** - Claude decides what actions are needed to accomplish the goal\n3. **The agent executes those actions** - Using integrated tools (file operations, code execution, web search, etc.)\n4. **Results loop back to Claude** - Claude evaluates the outcome and decides the next step\n5. **Repeat until complete** - This agentic loop continues until the task is accomplished\n\n## Key Capabilities\n\n- **Persistent State**: Maintains context across multiple interactions\n- **Tool Integration**: Access to file systems, code execution, web search, and MCP servers\n- **Automatic Context Management**: Handles token limits automatically for long-running tasks\n- **Fine-grained Permissions**: Control exactly what the agent can and cannot do\n- **Extensibility**: Create custom skills, subagents, hooks, and slash commands\n\n## Building Blocks\n\n- **Subagents**: Specialized agents that handle specific sub-tasks\n- **Skills**: Domain-specific capabilities for specialized behavior\n- **Hooks**: Custom logic triggered at execution phases\n- **Slash Commands**: User-defined commands for the agent\n- **MCP Servers**: External integrations via the Model Context Protocol\n\nThe SDK is essentially what powers Claude Code itself—it's the same infrastructure that lets Claude Code maintain a working environment, execute commands, and help you with complex coding tasks over multiple interactions."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":1467,"cache_read_input_tokens":34061,"cache_creation":{"ephemeral_5m_input_tokens":1467,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CVZYLTQg5aDKqx1QPoKt9","type":"assistant","uuid":"14acd775-0c42-48c7-985e-fe9c3d454ea8","timestamp":"2025-11-28T03:00:50.611Z"}
{"type":"file-history-snapshot","messageId":"10eb1885-b898-458e-aee8-9b81ea7ceb7c","snapshot":{"messageId":"10eb1885-b898-458e-aee8-9b81ea7ceb7c","trackedFileBackups":{},"timestamp":"2025-11-28T03:01:30.730Z"},"isSnapshotUpdate":false}
{"parentUuid":"14acd775-0c42-48c7-985e-fe9c3d454ea8","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","type":"user","message":{"role":"user","content":"What is the difference between me just using the default claude agent build process and the SDK?"},"uuid":"10eb1885-b898-458e-aee8-9b81ea7ceb7c","timestamp":"2025-11-28T03:01:30.729Z","thinkingMetadata":{"level":"none","disabled":true,"triggers":[]}}
{"parentUuid":"10eb1885-b898-458e-aee8-9b81ea7ceb7c","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01JimxEJWn5hPPYR4wdt3BTV","type":"message","role":"assistant","content":[{"type":"text","text":"The main difference is **control and deployment**:\n\n## Default Claude Agent Build Process\n- You're using Claude Code (the CLI tool) which is a **pre-built agent** running on Anthropic's infrastructure\n- Claude Code has fixed capabilities: file operations, code execution, bash commands, web search, etc.\n- You interact with it through the CLI in a conversational way\n- You can't customize what tools it has or how it behaves\n- It's designed specifically for software engineering tasks\n\n## Claude Agent SDK\n- You build your **own custom agent** from scratch using the SDK as a framework\n- You decide exactly what tools and capabilities your agent has\n- You can create specialized agent types for specific domains (not just coding)\n- You can integrate custom MCP servers, skills, and external services\n- You deploy and host your agent yourself (or on your infrastructure)\n- You have control over permissions, hooks, behavior, and extensibility\n\n## In Practice\n\n**Use Claude Code if**: You want an immediate, ready-to-use coding assistant. Just run commands and Claude helps.\n\n**Use the Agent SDK if**: You want to build a custom agent with specific capabilities for a particular use case—like a data analysis agent, customer support agent, or domain-specific automation tool. You're building a product or service, not just using a tool.\n\nThink of it like: Claude Code is a pre-made appliance, the SDK is the parts and framework to build your own appliance customized to your needs."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":431,"cache_read_input_tokens":35528,"cache_creation":{"ephemeral_5m_input_tokens":431,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CVZYPq5zQV3ET6HfKMFBf","type":"assistant","uuid":"c8097bc2-30f4-46ce-8b8f-f446a23ce3f9","timestamp":"2025-11-28T03:01:35.512Z"}
{"type":"file-history-snapshot","messageId":"111f0edb-0e00-4028-9bcd-055fb4495858","snapshot":{"messageId":"111f0edb-0e00-4028-9bcd-055fb4495858","trackedFileBackups":{},"timestamp":"2025-11-28T03:02:25.280Z"},"isSnapshotUpdate":false}
{"parentUuid":"c8097bc2-30f4-46ce-8b8f-f446a23ce3f9","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","type":"user","message":{"role":"user","content":"I have configured and created agents and allowed them to use custom MCP servers, can ytou just provide an example for me please?"},"uuid":"111f0edb-0e00-4028-9bcd-055fb4495858","timestamp":"2025-11-28T03:02:25.279Z","thinkingMetadata":{"level":"none","disabled":true,"triggers":[]}}
{"parentUuid":"111f0edb-0e00-4028-9bcd-055fb4495858","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","message":{"model":"claude-haiku-4-5-20251001","id":"msg_019dJZoKuh1EeAZ8fLuDfjUy","type":"message","role":"assistant","content":[{"type":"text","text":"I'll look up the official documentation to provide you with an accurate, practical example."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":356,"cache_read_input_tokens":35959,"cache_creation":{"ephemeral_5m_input_tokens":356,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CVZYTr8cDBw4B3wg1u9Ve","type":"assistant","uuid":"cc844a31-89cd-4b5f-92a7-7884a3407c34","timestamp":"2025-11-28T03:02:26.984Z"}
{"parentUuid":"cc844a31-89cd-4b5f-92a7-7884a3407c34","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","message":{"model":"claude-haiku-4-5-20251001","id":"msg_019dJZoKuh1EeAZ8fLuDfjUy","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TWbFxorsPG1N9UjF5FSu5X","name":"Task","input":{"subagent_type":"claude-code-guide","description":"Get Agent SDK MCP integration example","prompt":"The user has already configured agents with custom MCP servers and wants a practical code example showing how to create an agent using the Claude Agent SDK with MCP server integration. Please provide:\n\n1. A complete, working code example showing how to create and configure an agent with MCP servers\n2. Show how to add/configure MCP servers to an agent\n3. Include proper imports and initialization\n4. Keep it practical and runnable\n\nReference the official Claude Agent SDK Python documentation to ensure accuracy."}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":356,"cache_read_input_tokens":35959,"cache_creation":{"ephemeral_5m_input_tokens":356,"ephemeral_1h_input_tokens":0},"output_tokens":218,"service_tier":"standard"},"context_management":{"applied_edits":[]}},"requestId":"req_011CVZYTr8cDBw4B3wg1u9Ve","type":"assistant","uuid":"945b20d1-bccb-412d-a279-f6bfa85a29ae","timestamp":"2025-11-28T03:02:28.552Z"}
{"parentUuid":"945b20d1-bccb-412d-a279-f6bfa85a29ae","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","slug":"warm-forging-otter","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TWbFxorsPG1N9UjF5FSu5X","type":"tool_result","content":[{"type":"text","text":"Perfect! Now I have all the information needed. Let me compile a comprehensive, practical guide with complete working code examples based on the official documentation.\n\n## Complete Claude Agent SDK Guide: Creating Agents with MCP Server Integration\n\nBased on the official Claude Agent SDK documentation, here's a comprehensive guide with practical, runnable code examples.\n\n### 1. Installation\n\nFirst, install the Claude Agent SDK:\n\n```bash\npip install claude-agent-sdk\n```\n\nRequires Python 3.10+ and the Anthropic API key set in your environment.\n\n### 2. Basic Agent with In-Process MCP Server\n\nHere's a complete, working example creating an agent with custom tools:\n\n```python\nimport anyio\nimport os\nfrom claude_agent_sdk import (\n    tool,\n    create_sdk_mcp_server,\n    ClaudeAgentOptions,\n    ClaudeSDKClient\n)\n\n# Define custom tools using the @tool decorator\n@tool(\"add\", \"Add two numbers together\", {\"a\": float, \"b\": float})\nasync def add_numbers(args):\n    \"\"\"Add two numbers\"\"\"\n    result = args[\"a\"] + args[\"b\"]\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"The sum of {args['a']} and {args['b']} is {result}\"\n        }]\n    }\n\n@tool(\"multiply\", \"Multiply two numbers\", {\"a\": float, \"b\": float})\nasync def multiply_numbers(args):\n    \"\"\"Multiply two numbers\"\"\"\n    result = args[\"a\"] * args[\"b\"]\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"The product of {args['a']} and {args['b']} is {result}\"\n        }]\n    }\n\n@tool(\"subtract\", \"Subtract two numbers\", {\"a\": float, \"b\": float})\nasync def subtract_numbers(args):\n    \"\"\"Subtract b from a\"\"\"\n    result = args[\"a\"] - args[\"b\"]\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"{args['a']} minus {args['b']} equals {result}\"\n        }]\n    }\n\n# Create an in-process MCP server with your tools\ncalculator_server = create_sdk_mcp_server(\n    name=\"calculator\",\n    version=\"1.0.0\",\n    tools=[add_numbers, multiply_numbers, subtract_numbers]\n)\n\n# Configure the agent with the MCP server\nagent_options = ClaudeAgentOptions(\n    mcp_servers={\"calculator\": calculator_server},\n    allowed_tools=[\n        \"mcp__calculator__add\",\n        \"mcp__calculator__multiply\",\n        \"mcp__calculator__subtract\"\n    ]\n)\n\nasync def main():\n    \"\"\"Run the agent in interactive mode\"\"\"\n    async with ClaudeSDKClient(options=agent_options) as client:\n        # Send a prompt to the agent\n        await client.query(\"Calculate: What is 15 * 3 + 10?\")\n        \n        # Receive and print responses\n        async for message in client.receive_response():\n            print(message)\n\nif __name__ == \"__main__\":\n    anyio.run(main)\n```\n\n### 3. Advanced: Multiple MCP Servers (In-Process + External)\n\nHere's how to combine both SDK MCP servers (in-process) and external MCP servers:\n\n```python\nimport anyio\nfrom claude_agent_sdk import (\n    tool,\n    create_sdk_mcp_server,\n    ClaudeAgentOptions,\n    ClaudeSDKClient\n)\n\n# Define in-process tools\n@tool(\"greet\", \"Greet a user by name\", {\"name\": str})\nasync def greet_user(args):\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"Hello, {args['name']}! It's great to see you.\"\n        }]\n    }\n\n@tool(\"get_time\", \"Get the current time\", {})\nasync def get_current_time(args):\n    from datetime import datetime\n    current_time = datetime.now().strftime(\"%H:%M:%S\")\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"Current time: {current_time}\"\n        }]\n    }\n\n# Create SDK MCP server for in-process tools\ngreetings_server = create_sdk_mcp_server(\n    name=\"greetings\",\n    version=\"1.0.0\",\n    tools=[greet_user, get_current_time]\n)\n\n# Configure agent with both in-process and external MCP servers\nagent_options = ClaudeAgentOptions(\n    mcp_servers={\n        \"greetings\": greetings_server,  # In-process SDK server\n        \"filesystem\": {                  # External MCP server example\n            \"type\": \"stdio\",\n            \"command\": \"npx\",\n            \"args\": [\"@modelcontextprotocol/server-filesystem\"],\n            \"env\": {\n                \"ALLOWED_PATHS\": \"/home/user/documents\"\n            }\n        }\n    },\n    allowed_tools=[\n        \"mcp__greetings__greet\",\n        \"mcp__greetings__get_time\",\n        \"mcp__filesystem__list_files\"\n    ],\n    model=\"claude-sonnet-4-5-20250929\"  # Optional: specify model\n)\n\nasync def main():\n    async with ClaudeSDKClient(options=agent_options) as client:\n        await client.query(\"Greet Alice and tell me the current time\")\n        async for message in client.receive_response():\n            print(message)\n\nif __name__ == \"__main__\":\n    anyio.run(main)\n```\n\n### 4. Complex Tool with State Management\n\nHere's an example of a more sophisticated tool with internal state:\n\n```python\nimport anyio\nfrom claude_agent_sdk import (\n    tool,\n    create_sdk_mcp_server,\n    ClaudeAgentOptions,\n    ClaudeSDKClient\n)\n\n# Global state for demonstration (in production, use a database)\ntodo_list = []\n\n@tool(\"add_todo\", \"Add a task to the todo list\", {\"task\": str})\nasync def add_todo(args):\n    \"\"\"Add a new todo item\"\"\"\n    task = args[\"task\"]\n    todo_list.append({\"task\": task, \"completed\": False})\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"Added task: '{task}'. Total tasks: {len(todo_list)}\"\n        }]\n    }\n\n@tool(\"list_todos\", \"List all tasks in the todo list\", {})\nasync def list_todos(args):\n    \"\"\"List all todos\"\"\"\n    if not todo_list:\n        return {\n            \"content\": [{\n                \"type\": \"text\",\n                \"text\": \"Your todo list is empty!\"\n            }]\n        }\n    \n    tasks_text = \"\\n\".join(\n        f\"- {i+1}. {item['task']} ({'done' if item['completed'] else 'pending'})\"\n        for i, item in enumerate(todo_list)\n    )\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"Your tasks:\\n{tasks_text}\"\n        }]\n    }\n\n@tool(\"complete_todo\", \"Mark a task as complete\", {\"task_index\": int})\nasync def complete_todo(args):\n    \"\"\"Mark a todo as completed\"\"\"\n    index = args[\"task_index\"] - 1\n    if 0 <= index < len(todo_list):\n        todo_list[index][\"completed\"] = True\n        return {\n            \"content\": [{\n                \"type\": \"text\",\n                \"text\": f\"Completed: {todo_list[index]['task']}\"\n            }]\n        }\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"Invalid task index: {args['task_index']}\"\n        }]\n    }\n\n# Create MCP server with stateful tools\ntodo_server = create_sdk_mcp_server(\n    name=\"todo-manager\",\n    version=\"1.0.0\",\n    tools=[add_todo, list_todos, complete_todo]\n)\n\nagent_options = ClaudeAgentOptions(\n    mcp_servers={\"todo\": todo_server},\n    allowed_tools=[\n        \"mcp__todo__add_todo\",\n        \"mcp__todo__list_todos\",\n        \"mcp__todo__complete_todo\"\n    ]\n)\n\nasync def interactive_session():\n    \"\"\"Run an interactive todo agent session\"\"\"\n    async with ClaudeSDKClient(options=agent_options) as client:\n        prompts = [\n            \"Add these tasks: Buy groceries, Finish the project, Call mom\",\n            \"Show me my todo list\",\n            \"Mark the second task as complete\",\n            \"List my tasks again\"\n        ]\n        \n        for prompt in prompts:\n            print(f\"\\nUser: {prompt}\")\n            print(\"-\" * 50)\n            await client.query(prompt)\n            async for message in client.receive_response():\n                print(f\"Agent: {message}\")\n\nif __name__ == \"__main__\":\n    anyio.run(interactive_session())\n```\n\n### 5. Key Configuration Options\n\nHere's a reference for commonly used `ClaudeAgentOptions` parameters:\n\n```python\nagent_options = ClaudeAgentOptions(\n    # MCP servers (required if using custom tools)\n    mcp_servers={\n        \"alias\": sdk_server,  # In-process SDK MCP server\n        \"external\": {         # External subprocess MCP server\n            \"type\": \"stdio\",\n            \"command\": \"command-name\",\n            \"args\": [\"arg1\", \"arg2\"],\n            \"env\": {\"ENV_VAR\": \"value\"}\n        }\n    },\n    \n    # Allowed tools (tool names follow pattern: mcp__<alias>__<tool_name>)\n    allowed_tools=[\n        \"mcp__alias__tool1\",\n        \"mcp__alias__tool2\",\n    ],\n    \n    # Optional: Specify Claude model\n    model=\"claude-sonnet-4-5-20250929\",\n    \n    # Optional: Specify working directory\n    cwd=\"/path/to/working/directory\",\n)\n```\n\n### 6. Tool Definition Best Practices\n\n```python\n# Tool naming and description conventions\n@tool(\n    name=\"descriptive_name\",  # Use snake_case, single purpose\n    description=\"Clear, action-oriented description\",  # Helps Claude choose when to use\n    input_schema={\n        \"param1\": str,        # Type hints for inputs\n        \"param2\": int,\n        \"param3\": bool\n    }\n)\nasync def tool_function(args):\n    \"\"\"\n    Docstring for reference.\n    \n    Args are provided as a dict with keys matching input_schema.\n    Always return proper MCP response format.\n    \"\"\"\n    try:\n        # Your implementation\n        result = process_something(args[\"param1\"])\n        return {\n            \"content\": [{\n                \"type\": \"text\",\n                \"text\": f\"Result: {result}\"\n            }]\n        }\n    except Exception as e:\n        return {\n            \"content\": [{\n                \"type\": \"text\",\n                \"text\": f\"Error: {str(e)}\"\n            }]\n        }\n```\n\n### 7. Running Your Agent\n\n**One-off queries:**\n```python\nfrom claude_agent_sdk import query\n\nasync def main():\n    async for message in query(prompt=\"What is the capital of France?\"):\n        print(message)\n\nanyio.run(main)\n```\n\n**Interactive sessions:**\n```python\nasync with ClaudeSDKClient(options=options) as client:\n    await client.query(\"First prompt\")\n    async for msg in client.receive_response():\n        print(msg)\n    \n    # Continue conversation\n    await client.query(\"Follow-up question\")\n    async for msg in client.receive_response():\n        print(msg)\n```\n\n## Key Advantages of SDK MCP Servers\n\n1. **No subprocess management** - Tools run directly in your Python process\n2. **Better performance** - Eliminates inter-process communication overhead\n3. **Simpler deployment** - Single Python process instead of multiple\n4. **Easier debugging** - All code in the same process\n5. **Type safety** - Direct Python function calls with type hints\n\n## File Structure Recommendation\n\n```\nagent-project/\n├── agent.py              # Main agent configuration\n├── tools/\n│   ├── __init__.py\n│   ├── calculator.py     # Tool definitions\n│   ├── todo_manager.py\n│   └── utilities.py\n├── requirements.txt\n└── README.md\n```\n\n## Next Steps\n\n1. Review the [official Agent SDK reference documentation](https://docs.claude.com/en/docs/agent-sdk/python)\n2. Check the [MCP integration guide](https://docs.claude.com/en/docs/agent-sdk/mcp)\n3. Explore the [example repository](https://github.com/anthropics/claude-agent-sdk-demos)\n4. Consider using hooks for deterministic processing with the `pre_tool_use` and `post_tool_use` hooks\n\nSources:\n- [Claude Agent SDK Overview](https://docs.claude.com/en/api/agent-sdk/overview)\n- [GitHub: claude-agent-sdk-python](https://github.com/anthropics/claude-agent-sdk-python)\n- [Claude Agent SDK Tutorial: DataCamp](https://www.datacamp.com/tutorial/how-to-use-claude-agent-sdk)\n- [Building Agents with Claude Agent SDK](https://www.anthropic.com/engineering/building-agents-with-the-claude-agent-sdk)\n- [Agent SDK reference - Python](https://docs.claude.com/en/docs/agent-sdk/python)\n- [MCP in the SDK](https://docs.claude.com/en/docs/agent-sdk/mcp)\n- [Claude Agent SDK Demos](https://github.com/anthropics/claude-agent-sdk-demos)"}]}]},"uuid":"480ea5de-c0e4-4551-87a1-07f2c0829b3a","timestamp":"2025-11-28T03:04:00.418Z","toolUseResult":{"status":"completed","prompt":"The user has already configured agents with custom MCP servers and wants a practical code example showing how to create an agent using the Claude Agent SDK with MCP server integration. Please provide:\n\n1. A complete, working code example showing how to create and configure an agent with MCP servers\n2. Show how to add/configure MCP servers to an agent\n3. Include proper imports and initialization\n4. Keep it practical and runnable\n\nReference the official Claude Agent SDK Python documentation to ensure accuracy.","agentId":"601211b4","content":[{"type":"text","text":"Perfect! Now I have all the information needed. Let me compile a comprehensive, practical guide with complete working code examples based on the official documentation.\n\n## Complete Claude Agent SDK Guide: Creating Agents with MCP Server Integration\n\nBased on the official Claude Agent SDK documentation, here's a comprehensive guide with practical, runnable code examples.\n\n### 1. Installation\n\nFirst, install the Claude Agent SDK:\n\n```bash\npip install claude-agent-sdk\n```\n\nRequires Python 3.10+ and the Anthropic API key set in your environment.\n\n### 2. Basic Agent with In-Process MCP Server\n\nHere's a complete, working example creating an agent with custom tools:\n\n```python\nimport anyio\nimport os\nfrom claude_agent_sdk import (\n    tool,\n    create_sdk_mcp_server,\n    ClaudeAgentOptions,\n    ClaudeSDKClient\n)\n\n# Define custom tools using the @tool decorator\n@tool(\"add\", \"Add two numbers together\", {\"a\": float, \"b\": float})\nasync def add_numbers(args):\n    \"\"\"Add two numbers\"\"\"\n    result = args[\"a\"] + args[\"b\"]\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"The sum of {args['a']} and {args['b']} is {result}\"\n        }]\n    }\n\n@tool(\"multiply\", \"Multiply two numbers\", {\"a\": float, \"b\": float})\nasync def multiply_numbers(args):\n    \"\"\"Multiply two numbers\"\"\"\n    result = args[\"a\"] * args[\"b\"]\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"The product of {args['a']} and {args['b']} is {result}\"\n        }]\n    }\n\n@tool(\"subtract\", \"Subtract two numbers\", {\"a\": float, \"b\": float})\nasync def subtract_numbers(args):\n    \"\"\"Subtract b from a\"\"\"\n    result = args[\"a\"] - args[\"b\"]\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"{args['a']} minus {args['b']} equals {result}\"\n        }]\n    }\n\n# Create an in-process MCP server with your tools\ncalculator_server = create_sdk_mcp_server(\n    name=\"calculator\",\n    version=\"1.0.0\",\n    tools=[add_numbers, multiply_numbers, subtract_numbers]\n)\n\n# Configure the agent with the MCP server\nagent_options = ClaudeAgentOptions(\n    mcp_servers={\"calculator\": calculator_server},\n    allowed_tools=[\n        \"mcp__calculator__add\",\n        \"mcp__calculator__multiply\",\n        \"mcp__calculator__subtract\"\n    ]\n)\n\nasync def main():\n    \"\"\"Run the agent in interactive mode\"\"\"\n    async with ClaudeSDKClient(options=agent_options) as client:\n        # Send a prompt to the agent\n        await client.query(\"Calculate: What is 15 * 3 + 10?\")\n        \n        # Receive and print responses\n        async for message in client.receive_response():\n            print(message)\n\nif __name__ == \"__main__\":\n    anyio.run(main)\n```\n\n### 3. Advanced: Multiple MCP Servers (In-Process + External)\n\nHere's how to combine both SDK MCP servers (in-process) and external MCP servers:\n\n```python\nimport anyio\nfrom claude_agent_sdk import (\n    tool,\n    create_sdk_mcp_server,\n    ClaudeAgentOptions,\n    ClaudeSDKClient\n)\n\n# Define in-process tools\n@tool(\"greet\", \"Greet a user by name\", {\"name\": str})\nasync def greet_user(args):\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"Hello, {args['name']}! It's great to see you.\"\n        }]\n    }\n\n@tool(\"get_time\", \"Get the current time\", {})\nasync def get_current_time(args):\n    from datetime import datetime\n    current_time = datetime.now().strftime(\"%H:%M:%S\")\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"Current time: {current_time}\"\n        }]\n    }\n\n# Create SDK MCP server for in-process tools\ngreetings_server = create_sdk_mcp_server(\n    name=\"greetings\",\n    version=\"1.0.0\",\n    tools=[greet_user, get_current_time]\n)\n\n# Configure agent with both in-process and external MCP servers\nagent_options = ClaudeAgentOptions(\n    mcp_servers={\n        \"greetings\": greetings_server,  # In-process SDK server\n        \"filesystem\": {                  # External MCP server example\n            \"type\": \"stdio\",\n            \"command\": \"npx\",\n            \"args\": [\"@modelcontextprotocol/server-filesystem\"],\n            \"env\": {\n                \"ALLOWED_PATHS\": \"/home/user/documents\"\n            }\n        }\n    },\n    allowed_tools=[\n        \"mcp__greetings__greet\",\n        \"mcp__greetings__get_time\",\n        \"mcp__filesystem__list_files\"\n    ],\n    model=\"claude-sonnet-4-5-20250929\"  # Optional: specify model\n)\n\nasync def main():\n    async with ClaudeSDKClient(options=agent_options) as client:\n        await client.query(\"Greet Alice and tell me the current time\")\n        async for message in client.receive_response():\n            print(message)\n\nif __name__ == \"__main__\":\n    anyio.run(main)\n```\n\n### 4. Complex Tool with State Management\n\nHere's an example of a more sophisticated tool with internal state:\n\n```python\nimport anyio\nfrom claude_agent_sdk import (\n    tool,\n    create_sdk_mcp_server,\n    ClaudeAgentOptions,\n    ClaudeSDKClient\n)\n\n# Global state for demonstration (in production, use a database)\ntodo_list = []\n\n@tool(\"add_todo\", \"Add a task to the todo list\", {\"task\": str})\nasync def add_todo(args):\n    \"\"\"Add a new todo item\"\"\"\n    task = args[\"task\"]\n    todo_list.append({\"task\": task, \"completed\": False})\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"Added task: '{task}'. Total tasks: {len(todo_list)}\"\n        }]\n    }\n\n@tool(\"list_todos\", \"List all tasks in the todo list\", {})\nasync def list_todos(args):\n    \"\"\"List all todos\"\"\"\n    if not todo_list:\n        return {\n            \"content\": [{\n                \"type\": \"text\",\n                \"text\": \"Your todo list is empty!\"\n            }]\n        }\n    \n    tasks_text = \"\\n\".join(\n        f\"- {i+1}. {item['task']} ({'done' if item['completed'] else 'pending'})\"\n        for i, item in enumerate(todo_list)\n    )\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"Your tasks:\\n{tasks_text}\"\n        }]\n    }\n\n@tool(\"complete_todo\", \"Mark a task as complete\", {\"task_index\": int})\nasync def complete_todo(args):\n    \"\"\"Mark a todo as completed\"\"\"\n    index = args[\"task_index\"] - 1\n    if 0 <= index < len(todo_list):\n        todo_list[index][\"completed\"] = True\n        return {\n            \"content\": [{\n                \"type\": \"text\",\n                \"text\": f\"Completed: {todo_list[index]['task']}\"\n            }]\n        }\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"Invalid task index: {args['task_index']}\"\n        }]\n    }\n\n# Create MCP server with stateful tools\ntodo_server = create_sdk_mcp_server(\n    name=\"todo-manager\",\n    version=\"1.0.0\",\n    tools=[add_todo, list_todos, complete_todo]\n)\n\nagent_options = ClaudeAgentOptions(\n    mcp_servers={\"todo\": todo_server},\n    allowed_tools=[\n        \"mcp__todo__add_todo\",\n        \"mcp__todo__list_todos\",\n        \"mcp__todo__complete_todo\"\n    ]\n)\n\nasync def interactive_session():\n    \"\"\"Run an interactive todo agent session\"\"\"\n    async with ClaudeSDKClient(options=agent_options) as client:\n        prompts = [\n            \"Add these tasks: Buy groceries, Finish the project, Call mom\",\n            \"Show me my todo list\",\n            \"Mark the second task as complete\",\n            \"List my tasks again\"\n        ]\n        \n        for prompt in prompts:\n            print(f\"\\nUser: {prompt}\")\n            print(\"-\" * 50)\n            await client.query(prompt)\n            async for message in client.receive_response():\n                print(f\"Agent: {message}\")\n\nif __name__ == \"__main__\":\n    anyio.run(interactive_session())\n```\n\n### 5. Key Configuration Options\n\nHere's a reference for commonly used `ClaudeAgentOptions` parameters:\n\n```python\nagent_options = ClaudeAgentOptions(\n    # MCP servers (required if using custom tools)\n    mcp_servers={\n        \"alias\": sdk_server,  # In-process SDK MCP server\n        \"external\": {         # External subprocess MCP server\n            \"type\": \"stdio\",\n            \"command\": \"command-name\",\n            \"args\": [\"arg1\", \"arg2\"],\n            \"env\": {\"ENV_VAR\": \"value\"}\n        }\n    },\n    \n    # Allowed tools (tool names follow pattern: mcp__<alias>__<tool_name>)\n    allowed_tools=[\n        \"mcp__alias__tool1\",\n        \"mcp__alias__tool2\",\n    ],\n    \n    # Optional: Specify Claude model\n    model=\"claude-sonnet-4-5-20250929\",\n    \n    # Optional: Specify working directory\n    cwd=\"/path/to/working/directory\",\n)\n```\n\n### 6. Tool Definition Best Practices\n\n```python\n# Tool naming and description conventions\n@tool(\n    name=\"descriptive_name\",  # Use snake_case, single purpose\n    description=\"Clear, action-oriented description\",  # Helps Claude choose when to use\n    input_schema={\n        \"param1\": str,        # Type hints for inputs\n        \"param2\": int,\n        \"param3\": bool\n    }\n)\nasync def tool_function(args):\n    \"\"\"\n    Docstring for reference.\n    \n    Args are provided as a dict with keys matching input_schema.\n    Always return proper MCP response format.\n    \"\"\"\n    try:\n        # Your implementation\n        result = process_something(args[\"param1\"])\n        return {\n            \"content\": [{\n                \"type\": \"text\",\n                \"text\": f\"Result: {result}\"\n            }]\n        }\n    except Exception as e:\n        return {\n            \"content\": [{\n                \"type\": \"text\",\n                \"text\": f\"Error: {str(e)}\"\n            }]\n        }\n```\n\n### 7. Running Your Agent\n\n**One-off queries:**\n```python\nfrom claude_agent_sdk import query\n\nasync def main():\n    async for message in query(prompt=\"What is the capital of France?\"):\n        print(message)\n\nanyio.run(main)\n```\n\n**Interactive sessions:**\n```python\nasync with ClaudeSDKClient(options=options) as client:\n    await client.query(\"First prompt\")\n    async for msg in client.receive_response():\n        print(msg)\n    \n    # Continue conversation\n    await client.query(\"Follow-up question\")\n    async for msg in client.receive_response():\n        print(msg)\n```\n\n## Key Advantages of SDK MCP Servers\n\n1. **No subprocess management** - Tools run directly in your Python process\n2. **Better performance** - Eliminates inter-process communication overhead\n3. **Simpler deployment** - Single Python process instead of multiple\n4. **Easier debugging** - All code in the same process\n5. **Type safety** - Direct Python function calls with type hints\n\n## File Structure Recommendation\n\n```\nagent-project/\n├── agent.py              # Main agent configuration\n├── tools/\n│   ├── __init__.py\n│   ├── calculator.py     # Tool definitions\n│   ├── todo_manager.py\n│   └── utilities.py\n├── requirements.txt\n└── README.md\n```\n\n## Next Steps\n\n1. Review the [official Agent SDK reference documentation](https://docs.claude.com/en/docs/agent-sdk/python)\n2. Check the [MCP integration guide](https://docs.claude.com/en/docs/agent-sdk/mcp)\n3. Explore the [example repository](https://github.com/anthropics/claude-agent-sdk-demos)\n4. Consider using hooks for deterministic processing with the `pre_tool_use` and `post_tool_use` hooks\n\nSources:\n- [Claude Agent SDK Overview](https://docs.claude.com/en/api/agent-sdk/overview)\n- [GitHub: claude-agent-sdk-python](https://github.com/anthropics/claude-agent-sdk-python)\n- [Claude Agent SDK Tutorial: DataCamp](https://www.datacamp.com/tutorial/how-to-use-claude-agent-sdk)\n- [Building Agents with Claude Agent SDK](https://www.anthropic.com/engineering/building-agents-with-the-claude-agent-sdk)\n- [Agent SDK reference - Python](https://docs.claude.com/en/docs/agent-sdk/python)\n- [MCP in the SDK](https://docs.claude.com/en/docs/agent-sdk/mcp)\n- [Claude Agent SDK Demos](https://github.com/anthropics/claude-agent-sdk-demos)"}],"totalDurationMs":91833,"totalTokens":24807,"totalToolUseCount":18,"usage":{"input_tokens":6,"cache_creation_input_tokens":2024,"cache_read_input_tokens":19332,"cache_creation":{"ephemeral_5m_input_tokens":2024,"ephemeral_1h_input_tokens":0},"output_tokens":3445,"service_tier":"standard"}}}
{"parentUuid":"480ea5de-c0e4-4551-87a1-07f2c0829b3a","isSidechain":false,"userType":"external","cwd":"/home/stanner","sessionId":"df115407-75ec-4954-99ca-eea30c5f0587","version":"2.0.55","gitBranch":"","slug":"warm-forging-otter","message":{"model":"claude-haiku-4-5-20251001","id":"msg_013hW4vAsoUjEMgKo4KopuyA","type":"message","role":"assistant","content":[{"type":"text","text":"Here are practical examples of creating agents with custom MCP servers:\n\n## Simple In-Process MCP Server Example\n\n```python\nimport anyio\nfrom claude_agent_sdk import (\n    tool,\n    create_sdk_mcp_server,\n    ClaudeAgentOptions,\n    ClaudeSDKClient\n)\n\n# Define custom tools\n@tool(\"add\", \"Add two numbers\", {\"a\": float, \"b\": float})\nasync def add_numbers(args):\n    result = args[\"a\"] + args[\"b\"]\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"The sum is {result}\"\n        }]\n    }\n\n@tool(\"multiply\", \"Multiply two numbers\", {\"a\": float, \"b\": float})\nasync def multiply_numbers(args):\n    result = args[\"a\"] * args[\"b\"]\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"The product is {result}\"\n        }]\n    }\n\n# Create MCP server with your tools\ncalculator_server = create_sdk_mcp_server(\n    name=\"calculator\",\n    version=\"1.0.0\",\n    tools=[add_numbers, multiply_numbers]\n)\n\n# Configure agent\nagent_options = ClaudeAgentOptions(\n    mcp_servers={\"calculator\": calculator_server},\n    allowed_tools=[\n        \"mcp__calculator__add\",\n        \"mcp__calculator__multiply\"\n    ]\n)\n\nasync def main():\n    async with ClaudeSDKClient(options=agent_options) as client:\n        await client.query(\"What is 15 * 3 + 10?\")\n        async for message in client.receive_response():\n            print(message)\n\nif __name__ == \"__main__\":\n    anyio.run(main)\n```\n\n## Multiple MCP Servers (In-Process + External)\n\n```python\nagent_options = ClaudeAgentOptions(\n    mcp_servers={\n        \"calculator\": calculator_server,  # Your custom in-process server\n        \"filesystem\": {                    # External MCP server\n            \"type\": \"stdio\",\n            \"command\": \"npx\",\n            \"args\": [\"@modelcontextprotocol/server-filesystem\"],\n            \"env\": {\n                \"ALLOWED_PATHS\": \"/home/user/documents\"\n            }\n        }\n    },\n    allowed_tools=[\n        \"mcp__calculator__add\",\n        \"mcp__calculator__multiply\",\n        \"mcp__filesystem__list_files\"\n    ]\n)\n```\n\n## Stateful Tool Example\n\n```python\ntodo_list = []\n\n@tool(\"add_todo\", \"Add a task\", {\"task\": str})\nasync def add_todo(args):\n    task = args[\"task\"]\n    todo_list.append({\"task\": task, \"completed\": False})\n    return {\n        \"content\": [{\n            \"type\": \"text\",\n            \"text\": f\"Added: '{task}'\"\n        }]\n    }\n\n@tool(\"list_todos\", \"Show all tasks\", {})\nasync def list_todos(args):\n    if not todo_list:\n        return {\"content\": [{\"type\": \"text\", \"text\": \"No tasks\"}]}\n    \n    tasks_text = \"\\n\".join(\n        f\"- {item['task']}\" for item in todo_list\n    )\n    return {\"content\": [{\"type\": \"text\", \"text\": tasks_text}]}\n\ntodo_server = create_sdk_mcp_server(\n    name=\"todo\",\n    version=\"1.0.0\",\n    tools=[add_todo, list_todos]\n)\n```\n\nThe key pattern is:\n1. Define tools with `@tool()` decorator\n2. Create an MCP server with `create_sdk_mcp_server()`\n3. Pass it to `ClaudeAgentOptions` via the `mcp_servers` dict\n4. Whitelist the tools in `allowed_tools`\n5. Use `ClaudeSDKClient` to interact with your agent"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":3669,"cache_read_input_tokens":36315,"cache_creation":{"ephemeral_5m_input_tokens":3669,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CVZYas5rHMPrx6vTbGfxj","type":"assistant","uuid":"1c28d899-1bc2-42c8-84ff-ae5333db756a","timestamp":"2025-11-28T03:04:07.494Z"}
