#!/bin/bash
# Quick start script for CDSA Blue Team Agent

set -e

echo "=========================================="
echo "CDSA Blue Team Agent - Quick Start"
echo "=========================================="
echo ""

# Check Python
echo "[1/6] Checking Python installation..."
if ! command -v python3 &> /dev/null; then
    echo "ERROR: Python 3 not found. Please install Python 3.10+"
    exit 1
fi
PYTHON_VERSION=$(python3 --version)
echo "✓ Found: $PYTHON_VERSION"
echo ""

# Check Anthropic API key
echo "[2/6] Checking Anthropic API key..."
if [ -z "$ANTHROPIC_API_KEY" ]; then
    echo "ERROR: ANTHROPIC_API_KEY not set"
    echo "Please run: export ANTHROPIC_API_KEY='your-api-key-here'"
    exit 1
fi
echo "✓ API key configured"
echo ""

# Install Python dependencies
echo "[3/6] Installing Python dependencies..."
pip install -q -r requirements.txt
echo "✓ Dependencies installed"
echo ""

# Check ERIC tools
echo "[4/6] Checking ERIC Tools..."
ERIC_PATH="${ERIC_TOOLS_PATH:-/opt/ERIC}"
if [ -d "$ERIC_PATH" ]; then
    echo "✓ ERIC Tools found at: $ERIC_PATH"
    echo "  Tools available:"
    ls -1 "$ERIC_PATH" | grep -E "\.(exe|dll)$" | head -5
else
    echo "⚠ Warning: ERIC Tools not found at $ERIC_PATH"
    echo "  Please set ERIC_TOOLS_PATH environment variable"
    echo "  Or download from: https://ericzimmerman.github.io/"
fi
echo ""

# Check system tools
echo "[5/6] Checking system tools..."
tools_ok=true

if command -v yara &> /dev/null; then
    echo "✓ Yara found"
else
    echo "⚠ Yara not found (optional): install with 'apt-get install yara'"
    tools_ok=false
fi

if command -v chainsaw &> /dev/null; then
    echo "✓ Chainsaw found"
else
    echo "⚠ Chainsaw not found (optional): install from https://github.com/WithSecureLabs/chainsaw"
    tools_ok=false
fi
echo ""

# Make scripts executable
echo "[6/6] Setting up scripts..."
chmod +x blue_team_agent.py
chmod +x eric_tools_mcp_server.py
echo "✓ Scripts ready"
echo ""

echo "=========================================="
echo "Setup Complete!"
echo "=========================================="
echo ""
echo "Next steps:"
echo "1. Review SETUP_GUIDE.md for detailed configuration"
echo "2. Start the agent:"
echo "   python3 blue_team_agent.py"
echo ""
echo "3. Try these example commands:"
echo "   - 'help' for available tools"
echo "   - 'analyze' to start forensic analysis"
echo "   - 'hunt' to run threat hunting"
echo ""
