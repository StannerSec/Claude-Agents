<!-- Consolidated Threat Detection Rules for APT, Ransomware, and Botnet Threats -->
<group name="threat_detection,malware,apt,ransomware,botnet,infostealer">

  <!-- ============================================================ -->
  <!-- TOMIRIS APT DETECTION RULES -->
  <!-- ============================================================ -->

  <!-- Rule: Tomiris APT - C2 IP Connection (188.127.227.226) -->
  <rule id="101001" level="14">
    <if_sid>87101</if_sid>
    <field name="win.eventdata.destinationIp">^188\.127\.227\.226$</field>
    <description>Tomiris APT: Connection to known C2 IP 188.127.227.226 detected</description>
    <mitre>
      <id>T1071.001</id>
    </mitre>
    <group>pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,tsc_CC7.2,</group>
  </rule>

  <!-- Rule: Tomiris APT - C2 IP Connection (188.127.231.136) -->
  <rule id="101002" level="14">
    <if_sid>87101</if_sid>
    <field name="win.eventdata.destinationIp">^188\.127\.231\.136$</field>
    <description>Tomiris APT: Connection to known C2 IP 188.127.231.136 detected</description>
    <mitre>
      <id>T1071.001</id>
    </mitre>
    <group>pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,tsc_CC7.2,</group>
  </rule>

  <!-- Rule: Tomiris APT - Process Execution with Suspicious Command Line -->
  <rule id="101003" level="13">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.commandLine" type="pcre2">(?i)(reverseshell|telegram|discord).*--c2</field>
    <description>Tomiris APT: Suspicious process execution with C2 indicators detected</description>
    <mitre>
      <id>T1071.001</id>
      <id>T1059</id>
    </mitre>
    <group>pci_dss_10.6.1,gdpr_IV_35.7.d,nist_800_53_AU.6,</group>
  </rule>

  <!-- ============================================================ -->
  <!-- TRIGONA RANSOMWARE DETECTION RULES -->
  <!-- ============================================================ -->

  <!-- Rule: Trigona - BCP.exe Abuse Detection -->
  <rule id="101004" level="14">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)\\bcp\.exe$</field>
    <field name="win.eventdata.commandLine" type="pcre2">(?i)queryout</field>
    <description>Trigona Ransomware: SQL Server BCP.exe abuse for data extraction detected</description>
    <mitre>
      <id>T1190</id>
      <id>T1218.004</id>
    </mitre>
    <group>pci_dss_10.6.1,gdpr_IV_35.7.d,nist_800_53_AU.6,tsc_CC7.2,</group>
  </rule>

  <!-- Rule: Trigona - Database Connection Attempts Frequency Detection -->
  <rule id="101005" level="12" frequency="5" timeframe="60">
    <if_matched_sid>101004</if_matched_sid>
    <same_source_ip/>
    <description>Trigona Ransomware: Multiple database connection attempts detected (potential MS-SQL brute force - 5+ attempts in 60 seconds)</description>
    <mitre>
      <id>T1110.001</id>
    </mitre>
    <group>pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,</group>
  </rule>

  <!-- ============================================================ -->
  <!-- AKIRA RANSOMWARE DETECTION RULES -->
  <!-- ============================================================ -->

  <!-- Rule: Akira - Ngrok Process Execution Detection -->
  <rule id="101006" level="13">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)\\ngrok\.exe$</field>
    <description>Akira Ransomware: Ngrok tunneling tool execution detected (C2 tunneling)</description>
    <mitre>
      <id>T1572</id>
      <id>T1071</id>
    </mitre>
    <group>pci_dss_10.6.1,gdpr_IV_35.7.d,nist_800_53_AU.6,tsc_CC7.2,</group>
  </rule>

  <!-- Rule: Akira - Credential Dumping Tool Execution (Mimikatz) -->
  <rule id="101007" level="14">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.image" type="pcre2">(?i)(mimikatz|mimilib)\.exe$</field>
    <description>Akira Ransomware: Mimikatz credential dumping tool execution detected</description>
    <mitre>
      <id>T1003.001</id>
    </mitre>
    <group>pci_dss_10.6.1,gdpr_IV_35.7.d,nist_800_53_AU.6,tsc_CC7.2,</group>
  </rule>

  <!-- Rule: Akira - Ransomware File Extension Detection -->
  <rule id="101008" level="15">
    <if_group>syscheck</if_group>
    <field name="file" type="pcre2">(?i)\.(akira|powerranges|akiranew|aki)$</field>
    <description>Akira Ransomware: File with known ransomware extension detected (active encryption)</description>
    <mitre>
      <id>T1486</id>
    </mitre>
    <group>pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,tsc_CC7.2,</group>
  </rule>

  <!-- Rule: Akira - Shadow Copy Deletion (inhibiting recovery) -->
  <rule id="101009" level="14">
    <if_sid>61603</if_sid>
    <field name="win.eventdata.commandLine" type="pcre2">(?i)(vssadmin|wmic).*delete.*shadow</field>
    <description>Akira Ransomware: Shadow copy deletion detected (inhibiting system recovery)</description>
    <mitre>
      <id>T1490</id>
    </mitre>
    <group>pci_dss_10.6.1,gdpr_IV_35.7.d,nist_800_53_AU.6,tsc_CC7.2,</group>
  </rule>

  <!-- ============================================================ -->
  <!-- LUMMAC2 STEALER DETECTION RULES -->
  <!-- ============================================================ -->

  <!-- Rule: LummaC2 - Chrome Login Data File Access -->
  <rule id="101010" level="12">
    <if_group>syscheck</if_group>
    <field name="file" type="pcre2">(?i)Google\\Chrome.*Login Data$</field>
    <description>LummaC2 Stealer: Chrome credential database access detected (credential theft)</description>
    <mitre>
      <id>T1555.003</id>
    </mitre>
    <group>pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,tsc_CC7.2,</group>
  </rule>

  <!-- Rule: LummaC2 - Firefox Login Data File Access -->
  <rule id="101011" level="12">
    <if_group>syscheck</if_group>
    <field name="file" type="pcre2">(?i)Mozilla\\Firefox.*logins\.json$</field>
    <description>LummaC2 Stealer: Firefox credential database access detected (credential theft)</description>
    <mitre>
      <id>T1555.003</id>
    </mitre>
    <group>pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,tsc_CC7.2,</group>
  </rule>

  <!-- Rule: LummaC2 - C2 Communication Pattern Detection -->
  <rule id="101012" level="14">
    <if_sid>31101</if_sid>
    <match>POST /c2sock</match>
    <description>LummaC2 Stealer: Suspicious POST request to /c2sock endpoint (C2 communication)</description>
    <mitre>
      <id>T1041</id>
      <id>T1071.001</id>
    </mitre>
    <group>pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,tsc_CC7.2,</group>
  </rule>

  <!-- ============================================================ -->
  <!-- MIRAI/GAFGYT BOTNET DETECTION RULES -->
  <!-- ============================================================ -->

  <!-- Rule: Mirai/Gafgyt - Connection to Known C2 IP (209.141.44.28) -->
  <rule id="101013" level="14">
    <if_sid>87101</if_sid>
    <field name="win.eventdata.destinationIp">^209\.141\.44\.28$</field>
    <description>Mirai/Gafgyt Botnet: Connection to known C2 IP 209.141.44.28 detected</description>
    <mitre>
      <id>T1071.001</id>
    </mitre>
    <group>pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,tsc_CC7.2,</group>
  </rule>

  <!-- Rule: Mirai/Gafgyt - Connection to Known C2 IP (51.38.137.114) -->
  <rule id="101014" level="14">
    <if_sid>87101</if_sid>
    <field name="win.eventdata.destinationIp">^51\.38\.137\.114$</field>
    <description>Mirai/Gafgyt Botnet: Connection to known C2 IP 51.38.137.114 detected</description>
    <mitre>
      <id>T1071.001</id>
    </mitre>
    <group>pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,tsc_CC7.2,</group>
  </rule>

  <!-- Rule: Mirai/Gafgyt - Telnet Brute Force Attack Detection -->
  <rule id="101015" level="12" frequency="5" timeframe="60">
    <if_sid>5503</if_sid>
    <match>telnet</match>
    <same_source_ip/>
    <description>Mirai/Gafgyt Botnet: Telnet brute force attack detected (5+ failed attempts in 60 seconds)</description>
    <mitre>
      <id>T1110.001</id>
    </mitre>
    <group>authentication_failures,pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,</group>
  </rule>

  <!-- Rule: Mirai/Gafgyt - SSH Brute Force Attack Detection -->
  <rule id="101016" level="12" frequency="5" timeframe="60">
    <if_sid>5710</if_sid>
    <same_source_ip/>
    <description>Mirai/Gafgyt Botnet: SSH brute force attack detected (5+ failed attempts in 60 seconds)</description>
    <mitre>
      <id>T1110.001</id>
    </mitre>
    <group>authentication_failures,pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,</group>
  </rule>

  <!-- ============================================================ -->
  <!-- CROSS-THREAT CORRELATION RULES -->
  <!-- ============================================================ -->

  <!-- Rule: Multiple Brute Force Attacks from Same Source -->
  <rule id="101017" level="13">
    <if_sid>101015</if_sid>
    <if_matched_sid>101016</if_matched_sid>
    <same_source_ip/>
    <description>Botnet Activity: Multiple simultaneous brute force attack types detected from same source (potential botnet propagation)</description>
    <mitre>
      <id>T1110.001</id>
    </mitre>
    <group>pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,</group>
  </rule>

  <!-- Rule: Rapid File Encryption Detection (Frequency-Based) -->
  <rule id="101018" level="15" frequency="50" timeframe="60">
    <if_matched_sid>101008</if_matched_sid>
    <description>Ransomware Activity: Rapid file encryption detected (50+ encrypted files in 60 seconds - active ransomware attack)</description>
    <mitre>
      <id>T1486</id>
    </mitre>
    <group>pci_dss_11.4,gdpr_IV_35.7.d,nist_800_53_SI.4,</group>
  </rule>

</group>
